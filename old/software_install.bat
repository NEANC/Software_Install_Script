@ECHO off

REM License
REM ??????? Apache License Version 2.0 ???

title ???? Winget ?????????????????????

ECHO.
ECHO ????????????????????????????????????????? Winget ?งา???????????????????? Winget ?งา????
ECHO ??????????????????
pause > nul

REM ???????
%1 mshta vbscript:CreateObject("Shell.Application").ShellExecute("cmd.exe","/c %~s0 ::","","runas",1)(window.close)&&exit
cd /d "%~dp0"

REM ??????????????งา????
if not exist "software_list.txt" (
    ECHO ?????งา??????????????????งา??????
    ECHO ???????????????????
    pause > nul
    exit /b
)

REM ?????งา?? ? ?งแ???
winget source remove winget
winget source add winget https://mirrors.ustc.edu.cn/winget-source

tasklist | find /i "v2rayN.exe" >nul
if %errorlevel% EQU 0 (
    ECHO ???? v2rayN ???????งต???????????????????????
    ECHO ??????????????????????????
    pause > nul
    title ?????????????? Winget ?????????????????????
    REM ????winget????????
    winget settings --enable ProxyCommandLineOptions

    REM ???งุ???????งา????????????????????http???????
    for /f "tokens=*" %%a in (software_list.txt) do (
        ECHO ??????: %%a
        winget install %%a --proxy http://127.0.0.1:10809
    )
) else (
    title ????????????? Winget ?????????????????????
    REM ???งุ???????งา?????????????
    for /f "tokens=*" %%a in (software_list.txt) do (
        ECHO ??????: %%a
        winget install %%a
    )
)

REM ?????งา?? ? ????
winget source reset winget

ECHO ?????????????????????
pause > nul
exit